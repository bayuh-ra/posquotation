<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Management - LAP I.T. Solutions</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="backend/config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 0;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        /* Header Section */
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            font-size: 2rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-header h1::before {
            content: "üõ†Ô∏è";
            font-size: 2.5rem;
        }
        
        .content-wrapper {
            padding: 30px 40px;
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: #2d3748;
            padding-bottom: 12px;
            border-bottom: 3px solid #667eea;
            display: inline-block;
        }

        h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #4a5568;
        }
        
        .tabs {
            display: flex;
            gap: 0;
            margin: 0;
            background: #f7fafc;
            padding: 0 40px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            padding: 18px 28px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #718096;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            background: linear-gradient(135deg, #f6f8fb 0%, #f0f4f8 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .form-section h3 {
            margin-top: 0;
            color: #2d3748;
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section h3::before {
            content: "üìù";
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #63408a 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #dd6b20 0%, #c05621 100%);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        /* Table styles */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
            background: white;
        }
        
        th, td {
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }
        
        /* Truncate long text in description columns */
        table td:nth-child(4) {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Truncate name column in products table */
        #products-list table td:nth-child(1) {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* For package types table (description is 2nd column) */
        #package-types-list table td:nth-child(2) {
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tbody tr {
            transition: all 0.2s;
        }
        
        tbody tr:hover {
            background: #f7fafc;
            transform: scale(1.01);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }
        
        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .actions .btn {
            padding: 8px 16px;
            font-size: 13px;
            white-space: nowrap;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
            font-size: 16px;
        }
        
        .message {
            padding: 14px 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message::before {
            font-size: 20px;
        }
        
        .message.success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }

        .message.success::before {
            content: "‚úì";
        }
        
        .message.error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #f56565;
        }

        .message.error::before {
            content: "‚úï";
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 16px;
            max-width: 550px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-header h3 {
            margin: 0;
            color: #2d3748;
            font-size: 1.5rem;
        }

        .close-btn {
            background: #e2e8f0;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #cbd5e0;
            transform: rotate(90deg);
        }

        /* Sub-tab styles */
        .sub-tab.active {
            color: #667eea;
            border-bottom-color: #667eea !important;
        }

        .sub-page {
            display: none;
        }

        .sub-page.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        /* Checkbox list for products */
        .product-checkbox-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            background: #f7fafc;
        }

        .product-checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }

        .product-checkbox-item:hover {
            background: #edf2f7;
            border-color: #667eea;
        }

        .product-checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .product-checkbox-item label {
            margin: 0;
            cursor: pointer;
            flex: 1;
            font-weight: 500;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .admin-header {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
            }

            .admin-header h1 {
                font-size: 1.5rem;
            }

            .content-wrapper {
                padding: 20px;
            }

            .tabs {
                padding: 0 20px;
            }

            h2 {
                font-size: 1.3rem;
            }

            .tab {
                padding: 14px 20px;
                font-size: 13px;
            }

            .form-section {
                padding: 20px;
            }

            .btn {
                padding: 10px 20px;
                font-size: 13px;
                width: 100%;
                margin-bottom: 8px;
            }

            .admin-header .btn-secondary {
                width: auto;
            }

            th, td {
                padding: 12px 8px;
                font-size: 12px;
            }

            .actions {
                flex-direction: column;
                gap: 6px;
            }

            .actions .btn {
                width: 100%;
            }

            table {
                min-width: 500px;
            }

            input, select, textarea {
                padding: 10px 14px;
                font-size: 14px;
            }

            /* Make filters stack vertically on mobile */
            .form-section > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }

            .form-section > div[style*="grid-template-columns"] button {
                width: 100%;
            }

            .modal-content {
                padding: 25px;
                width: 95%;
            }
        }

        @media (max-width: 480px) {
            .admin-header h1 {
                font-size: 1.3rem;
            }

            .tab {
                padding: 12px 16px;
                font-size: 12px;
            }

            table {
                min-width: 400px;
                font-size: 11px;
            }

            th, td {
                padding: 10px 6px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Modern Header -->
        <div class="admin-header">
            <h1>Database Management</h1>
            <button class="btn btn-secondary" onclick="goBack()">‚Üê Back to Home</button>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('units')">Units</button>
            <button class="tab" onclick="switchTab('categories')">Product Categories</button>
            <button class="tab" onclick="switchTab('products')">Products</button>
            <button class="tab" onclick="switchTab('pos')">POS Packages</button>
            <button class="tab" onclick="switchTab('employees')">Employees</button>
        </div>
        
        <!-- Content Area -->
        <div class="content-wrapper">
        
        <!-- UNITS TAB -->
        <div id="units" class="tab-content active">
            <h2>Manage Units</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="openAddUnitModal()">+ Add New Unit</button>
            </div>
            <div id="units-message"></div>
            <div class="table-container" id="units-list">
                <div class="loading">Loading...</div>
            </div>
        </div>
        
        <!-- CATEGORIES TAB -->
        <div id="categories" class="tab-content">
            <h2>Manage Product Categories</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="openAddCategoryModal()">+ Add New Category</button>
            </div>
            <div id="categories-message"></div>
            <div class="table-container" id="categories-list">
                <div class="loading">Loading...</div>
            </div>
        </div>
        
        <!-- PRODUCTS TAB -->
        <div id="products" class="tab-content">
            <h2>Manage Products</h2>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 15px;">
                <button class="btn btn-primary" onclick="openAddProductModal()">+ Add New Product</button>
                <div style="display: flex; gap: 10px; align-items: center; flex: 1; max-width: 500px;">
                    <input type="text" id="search-product-name" placeholder="üîç Search products..." onkeyup="searchProducts()" style="flex: 1; padding: 10px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                    <button class="btn btn-secondary" onclick="openProductFilterModal()">Filter</button>
                </div>
            </div>
            <div id="products-message"></div>
            <div class="table-container" id="products-list">
                <div class="loading">Loading...</div>
            </div>
        </div>
        
        <!-- POS PACKAGES TAB -->
        <div id="pos" class="tab-content">
            <h2>Manage POS Packages</h2>
            
            <!-- Sub-navigation for POS -->
            <div style="display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #e2e8f0; padding-bottom: 0;">
                <button class="sub-tab active" onclick="switchPOSSubTab('package-types-sub')" style="padding: 12px 24px; background: transparent; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: #718096; transition: all 0.3s;">
                    Package Types
                </button>
                <button class="sub-tab" onclick="switchPOSSubTab('package-products-sub')" style="padding: 12px 24px; background: transparent; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: #718096; transition: all 0.3s;">
                    Package Products
                </button>
            </div>

            <!-- Package Types Sub-page -->
            <div id="package-types-sub" class="sub-page active">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openAddPackageTypeModal()">+ Add New Package Type</button>
                </div>
                <div id="package-types-message"></div>
                <div class="table-container" id="package-types-list">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Package Products Sub-page -->
            <div id="package-products-sub" class="sub-page" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 15px;">
                    <button class="btn btn-primary" onclick="openAddPackageProductModal()">+ Add Products to Package</button>
                    <div style="display: flex; gap: 10px; align-items: center; flex: 1; max-width: 500px;">
                        <input type="text" id="search-package-product" placeholder="üîç Search package products..." onkeyup="searchPackageProducts()" style="flex: 1; padding: 10px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        <button class="btn btn-secondary" onclick="openPackageProductFilterModal()">Filter</button>
                    </div>
                </div>
                <div id="package-products-message"></div>
                <div class="table-container" id="package-products-list">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>

        <!-- EMPLOYEES TAB -->
        <div id="employees" class="tab-content">
            <h2>Manage Employees</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="openAddEmployeeModal()">+ Add New Employee</button>
            </div>
            <div id="employees-message"></div>
            <div class="table-container" id="employees-list">
                <div class="loading">Loading...</div>
            </div>
        </div>
        
        </div><!-- End content-wrapper -->
    </div><!-- End container -->

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Product</h3>
                <button class="close-btn" onclick="closeEditProductModal()">&times;</button>
            </div>
            <div id="edit-product-message"></div>
            <input type="hidden" id="edit-product-old-name">
            <div class="form-group">
                <label>Product Name</label>
                <input type="text" id="edit-product-name">
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="edit-product-category"></select>
            </div>
            <div class="form-group">
                <label>Unit</label>
                <select id="edit-product-unit">
                    <option value="">Select unit</option>
                </select>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="edit-product-description"></textarea>
            </div>
            <div class="form-group">
                <label>Base Price</label>
                <input type="number" id="edit-product-price" step="0.01">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="updateProduct()">Update</button>
                <button class="btn btn-secondary" onclick="closeEditProductModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Package Type Modal -->
    <div id="editPackageModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Package Type</h3>
                <button class="close-btn" onclick="closeEditPackageModal()">&times;</button>
            </div>
            <div id="edit-package-message"></div>
            <input type="hidden" id="edit-package-old-name">
            <div class="form-group">
                <label>Package Name</label>
                <input type="text" id="edit-package-name">
            </div>
            <div class="form-group">
                <label>Description/Inclusions</label>
                <textarea id="edit-package-description"></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="updatePackageType()">Update</button>
                <button class="btn btn-secondary" onclick="closeEditPackageModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Employee Modal -->
    <div id="editEmployeeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Employee</h3>
                <button class="close-btn" onclick="closeEditEmployeeModal()">&times;</button>
            </div>
            <form onsubmit="event.preventDefault(); updateEmployee();" autocomplete="off">
            <div id="edit-employee-message"></div>
            <input type="hidden" id="edit-employee-id">
            <div class="form-group">
                <label>Employee Code</label>
                <input type="text" id="edit-employee-code" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="edit-employee-fullname" autocomplete="off">
            </div>
            <div class="form-group">
                <label>New Password (leave blank to keep current)</label>
                <input type="password" id="edit-employee-password" autocomplete="new-password">
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="edit-employee-active">
                    <option value="true">Active</option>
                    <option value="false">Inactive</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">Update</button>
                <button type="button" class="btn btn-secondary" onclick="closeEditEmployeeModal()">Cancel</button>
            </div>
            </form>
        </div>
    </div>

    <!-- Edit Unit Modal -->
    <div id="editUnitModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Unit</h3>
                <button class="close-btn" onclick="closeEditUnitModal()">&times;</button>
            </div>
            <div id="edit-unit-message"></div>
            <input type="hidden" id="edit-unit-old-name">
            <div class="form-group">
                <label>Unit Name</label>
                <input type="text" id="edit-unit-name">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="updateUnit()">Update</button>
                <button class="btn btn-secondary" onclick="closeEditUnitModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div id="editCategoryModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Category</h3>
                <button class="close-btn" onclick="closeEditCategoryModal()">&times;</button>
            </div>
            <div id="edit-category-message"></div>
            <input type="hidden" id="edit-category-old-name">
            <div class="form-group">
                <label>Category Name</label>
                <input type="text" id="edit-category-name">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="updateCategory()">Update</button>
                <button class="btn btn-secondary" onclick="closeEditCategoryModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Multiple Products Modal -->
    <div id="addProductsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Add Products to Package</h3>
                <button class="close-btn" onclick="closeAddProductsModal()">&times;</button>
            </div>
            <div id="add-products-message"></div>
            
            <div class="form-group">
                <label>Selected Package: <strong id="selected-package-name" style="color: #667eea;">None</strong></label>
            </div>

            <div class="form-group">
                <label>Select Products (Check all that apply):</label>
                <div class="product-checkbox-list" id="products-checkbox-list">
                    <div class="loading">Loading products...</div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="addMultipleProducts()">Add Selected Products</button>
                <button class="btn btn-secondary" onclick="closeAddProductsModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Product Filter Modal -->
    <div id="productFilterModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Filter Products</h3>
                <button class="close-btn" onclick="closeProductFilterModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>Filter by Category</label>
                <select id="filter-product-category">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="form-group">
                <label>Search by Name</label>
                <input type="text" id="filter-product-name" placeholder="Type to search...">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="applyProductFilter()" style="flex: 1;">Apply Filter</button>
                <button class="btn btn-secondary" onclick="clearProductFilters()" style="flex: 1;">Clear All</button>
            </div>
        </div>
    </div>

    <!-- Package Product Filter Modal -->
    <div id="packageProductFilterModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Filter Package Products</h3>
                <button class="close-btn" onclick="closePackageProductFilterModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>Filter by Package Type</label>
                <select id="filter-package-type">
                    <option value="">All Package Types</option>
                </select>
            </div>
            <div class="form-group">
                <label>Filter by Product</label>
                <select id="filter-product">
                    <option value="">All Products</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="applyPackageProductFilter()" style="flex: 1;">Apply Filter</button>
                <button class="btn btn-secondary" onclick="clearPackageProductFilters()" style="flex: 1;">Clear All</button>
            </div>
        </div>
    </div>

    <!-- Add Package Product Modal (New modal to replace the form section) -->
    <div id="addPackageProductModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Add Products to Package</h3>
                <button class="close-btn" onclick="closeAddPackageProductModal()">&times;</button>
            </div>
            <div id="add-package-product-message"></div>
            
            <div class="form-group">
                <label>Select Package Type</label>
                <select id="pp-package-type-select">
                    <option value="">Select a package type</option>
                </select>
            </div>

            <div class="form-group">
                <label>Selected Package: <strong id="selected-package-name-new" style="color: #667eea;">None</strong></label>
            </div>

            <div class="form-group">
                <label>Select Products (Check all that apply):</label>
                <div class="product-checkbox-list" id="products-checkbox-list-new">
                    <div class="loading">Please select a package type first...</div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="addMultipleProductsNew()" style="flex: 1;">Add Selected Products</button>
                <button class="btn btn-secondary" onclick="closeAddPackageProductModal()" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Unit Modal -->
    <div id="addUnitModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Add New Unit</h3>
                <button class="close-btn" onclick="closeAddUnitModal()">&times;</button>
            </div>
            <div id="add-unit-message"></div>
            <div class="form-group">
                <label>Unit Name</label>
                <input type="text" id="add-unit-name" placeholder="e.g., License, PC, Set">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="addUnit()" style="flex: 1;">Add Unit</button>
                <button class="btn btn-secondary" onclick="closeAddUnitModal()" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Add New Category</h3>
                <button class="close-btn" onclick="closeAddCategoryModal()">&times;</button>
            </div>
            <div id="add-category-message"></div>
            <div class="form-group">
                <label>Category Name</label>
                <input type="text" id="add-category-name" placeholder="e.g., POS Software, Hardware">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="addCategory()" style="flex: 1;">Add Category</button>
                <button class="btn btn-secondary" onclick="closeAddCategoryModal()" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Product</h3>
                <button class="close-btn" onclick="closeAddProductModal()">&times;</button>
            </div>
            <div id="add-product-message"></div>
            <div class="form-group">
                <label>Product Name</label>
                <input type="text" id="add-product-name" placeholder="e.g., IBS XPOS RETAIL POS">
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="add-product-category">
                    <option value="">Select category</option>
                </select>
            </div>
            <div class="form-group">
                <label>Unit</label>
                <select id="add-product-unit">
                    <option value="">Select unit</option>
                </select>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="add-product-description" placeholder="Product description"></textarea>
            </div>
            <div class="form-group">
                <label>Base Price</label>
                <input type="number" id="add-product-price" placeholder="0.00" step="0.01">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="addProduct()" style="flex: 1;">Add Product</button>
                <button class="btn btn-secondary" onclick="closeAddProductModal()" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Package Type Modal -->
    <div id="addPackageTypeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Package Type</h3>
                <button class="close-btn" onclick="closeAddPackageTypeModal()">&times;</button>
            </div>
            <div id="add-package-type-message"></div>
            <div class="form-group">
                <label>Package Name</label>
                <input type="text" id="add-package-name" placeholder="e.g., Standard POS Retail Package">
            </div>
            <div class="form-group">
                <label>Description/Inclusions</label>
                <textarea id="add-package-description" placeholder="Package inclusions and details"></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="addPackageType()" style="flex: 1;">Add Package Type</button>
                <button class="btn btn-secondary" onclick="closeAddPackageTypeModal()" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Employee</h3>
                <button class="close-btn" onclick="closeAddEmployeeModal()">&times;</button>
            </div>
            <form onsubmit="event.preventDefault(); addEmployee();" autocomplete="off">
            <div id="add-employee-message"></div>
            <div class="form-group">
                <label>Employee Code</label>
                <input type="text" id="add-employee-code" placeholder="e.g., EMP001" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="add-employee-name" placeholder="e.g., John Doe" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="add-employee-password" placeholder="Enter password" autocomplete="new-password">
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="add-employee-status">
                    <option value="true">Active</option>
                    <option value="false">Inactive</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">Add Employee</button>
                <button type="button" class="btn btn-secondary" onclick="closeAddEmployeeModal()" style="flex: 1;">Cancel</button>
            </div>
            </form>
        </div>
    </div>

    <!-- Unit Detail Modal -->
    <div id="detailUnitModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Unit Details</h3>
                <button class="close-btn" onclick="closeDetailUnitModal()">&times;</button>
            </div>
            <div style="padding: 10px 0;">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">NAME</label>
                    <div id="detail-unit-name" style="font-size: 18px; font-weight: bold; color: #2d3748; margin-top: 5px;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                <button class="btn btn-warning" onclick="editUnitFromDetail()" style="flex: 1;">Edit</button>
                <button class="btn btn-danger" onclick="deleteUnitFromDetail()" style="flex: 1;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Category Detail Modal -->
    <div id="detailCategoryModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Category Details</h3>
                <button class="close-btn" onclick="closeDetailCategoryModal()">&times;</button>
            </div>
            <div style="padding: 10px 0;">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">NAME</label>
                    <div id="detail-category-name" style="font-size: 18px; font-weight: bold; color: #2d3748; margin-top: 5px;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                <button class="btn btn-warning" onclick="editCategoryFromDetail()" style="flex: 1;">Edit</button>
                <button class="btn btn-danger" onclick="deleteCategoryFromDetail()" style="flex: 1;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Package Type Detail Modal -->
    <div id="detailPackageModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Package Type Details</h3>
                <button class="close-btn" onclick="closeDetailPackageModal()">&times;</button>
            </div>
            <div style="padding: 10px 0;">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">NAME</label>
                    <div id="detail-package-name" style="font-size: 18px; font-weight: bold; color: #2d3748; margin-top: 5px;"></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">DESCRIPTION</label>
                    <div id="detail-package-description" style="font-size: 14px; color: #2d3748; margin-top: 5px; line-height: 1.6;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                <button class="btn btn-warning" onclick="editPackageFromDetail()" style="flex: 1;">Edit</button>
                <button class="btn btn-danger" onclick="deletePackageFromDetail()" style="flex: 1;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Employee Detail Modal -->
    <div id="detailEmployeeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Employee Details</h3>
                <button class="close-btn" onclick="closeDetailEmployeeModal()">&times;</button>
            </div>
            <div style="padding: 10px 0;">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">EMPLOYEE CODE</label>
                    <div id="detail-employee-code" style="font-size: 18px; font-weight: bold; color: #2d3748; margin-top: 5px;"></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">FULL NAME</label>
                    <div id="detail-employee-name" style="font-size: 16px; color: #2d3748; margin-top: 5px;"></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">STATUS</label>
                    <div id="detail-employee-status" style="font-size: 14px; margin-top: 5px;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                <button class="btn btn-warning" onclick="editEmployeeFromDetail()" style="flex: 1;">Edit</button>
                <button class="btn btn-danger" onclick="deleteEmployeeFromDetail()" style="flex: 1;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="detailProductModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Product Details</h3>
                <button class="close-btn" onclick="closeDetailProductModal()">&times;</button>
            </div>
            <div style="padding: 10px 0;">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">NAME</label>
                    <div id="detail-product-name" style="font-size: 18px; font-weight: bold; color: #2d3748; margin-top: 5px;"></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="font-weight: 600; color: #4a5568; font-size: 12px;">CATEGORY</label>
                        <div id="detail-product-category" style="font-size: 14px; color: #2d3748; margin-top: 5px;"></div>
                    </div>
                    <div>
                        <label style="font-weight: 600; color: #4a5568; font-size: 12px;">UNIT</label>
                        <div id="detail-product-unit" style="font-size: 14px; color: #2d3748; margin-top: 5px;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">DESCRIPTION</label>
                    <div id="detail-product-description" style="font-size: 14px; color: #2d3748; margin-top: 5px; line-height: 1.6;"></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #4a5568; font-size: 12px;">PRICE</label>
                    <div id="detail-product-price" style="font-size: 20px; font-weight: bold; color: #667eea; margin-top: 5px;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                <button class="btn btn-warning" onclick="editFromDetail()" style="flex: 1;">Edit</button>
                <button class="btn btn-danger" onclick="deleteFromDetail()" style="flex: 1;">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase (check if already exists to avoid conflicts)
        let supabaseClient;
        if (window.lapSupabaseClient) {
            supabaseClient = window.lapSupabaseClient;
        } else {
            supabaseClient = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
            window.lapSupabaseClient = supabaseClient;
        }
        
        // Navigation
        function goBack() {
            window.location.href = 'index.html';
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            loadTabData(tabName);
        }
        
        function showMessage(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="message ${isError ? 'error' : 'success'}">${message}</div>`;
            setTimeout(() => el.innerHTML = '', 3000);
        }
        
        // ===== UNITS =====
        async function loadUnits() {
            const container = document.getElementById('units-list');
            const { data, error } = await supabaseClient.from('units').select('*').order('name');
            
            if (error) {
                container.innerHTML = '<p class="error">Error loading units: ' + error.message + '</p>';
                return;
            }
            
            let html = '<table><tr><th>Name</th></tr>';
            data.forEach((unit, index) => {
                const rowId = `unit-row-${index}`;
                html += `<tr id="${rowId}" style="cursor: pointer;" data-name="${encodeURIComponent(unit.name)}">
                    <td>${unit.name}</td>
                </tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
            
            // Add click listeners
            data.forEach((unit, index) => {
                const row = document.getElementById(`unit-row-${index}`);
                if (row) {
                    row.addEventListener('click', function() {
                        showUnitDetail(decodeURIComponent(this.dataset.name));
                    });
                }
            });
        }

        function showUnitDetail(name) {
            document.getElementById('detail-unit-name').textContent = name;
            document.getElementById('detailUnitModal').dataset.name = name;
            document.getElementById('detailUnitModal').classList.add('active');
        }

        function closeDetailUnitModal() {
            document.getElementById('detailUnitModal').classList.remove('active');
        }

        function editUnitFromDetail() {
            const modal = document.getElementById('detailUnitModal');
            editUnit(modal.dataset.name);
            closeDetailUnitModal();
        }

        function deleteUnitFromDetail() {
            const modal = document.getElementById('detailUnitModal');
            deleteUnit(modal.dataset.name);
            closeDetailUnitModal();
        }
        
        async function addUnit() {
            const name = document.getElementById('add-unit-name').value.trim();
            if (!name) {
                showMessage('add-unit-message', 'Please enter a unit name', true);
                return;
            }
            
            const { error } = await supabaseClient.from('units').insert([{ name }]);
            if (error) {
                showMessage('add-unit-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('units-message', 'Unit added successfully!');
            document.getElementById('add-unit-name').value = '';
            closeAddUnitModal();
            loadUnits();
        }

        function openAddUnitModal() {
            document.getElementById('addUnitModal').classList.add('active');
        }

        function closeAddUnitModal() {
            document.getElementById('addUnitModal').classList.remove('active');
            document.getElementById('add-unit-message').innerHTML = '';
        }

        function editUnit(name) {
            document.getElementById('edit-unit-old-name').value = name;
            document.getElementById('edit-unit-name').value = name;
            document.getElementById('editUnitModal').classList.add('active');
        }

        function closeEditUnitModal() {
            document.getElementById('editUnitModal').classList.remove('active');
        }

        async function updateUnit() {
            const oldName = document.getElementById('edit-unit-old-name').value;
            const newName = document.getElementById('edit-unit-name').value.trim();
            
            if (!newName) {
                showMessage('edit-unit-message', 'Please enter a unit name', true);
                return;
            }
            
            const { error } = await supabaseClient
                .from('units')
                .update({ name: newName })
                .eq('name', oldName);
            
            if (error) {
                showMessage('edit-unit-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('units-message', 'Unit updated successfully!');
            closeEditUnitModal();
            loadUnits();
        }
        
        async function deleteUnit(name) {
            if (!confirm(`Delete unit "${name}"?`)) return;
            
            const { error } = await supabaseClient.from('units').delete().eq('name', name);
            if (error) {
                alert('Error: ' + error.message);
                return;
            }
            
            showMessage('units-message', 'Unit deleted successfully!');
            loadUnits();
        }
        
        // ===== CATEGORIES =====
        async function loadCategories() {
            const container = document.getElementById('categories-list');
            const { data, error } = await supabaseClient.from('product_categories').select('*').order('name');
            
            if (error) {
                container.innerHTML = '<p class="error">Error loading categories: ' + error.message + '</p>';
                return;
            }
            
            let html = '<table><tr><th>Name</th></tr>';
            data.forEach((cat, index) => {
                const rowId = `category-row-${index}`;
                html += `<tr id="${rowId}" style="cursor: pointer;" data-name="${encodeURIComponent(cat.name)}">
                    <td>${cat.name}</td>
                </tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
            
            // Add click listeners
            data.forEach((cat, index) => {
                const row = document.getElementById(`category-row-${index}`);
                if (row) {
                    row.addEventListener('click', function() {
                        showCategoryDetail(decodeURIComponent(this.dataset.name));
                    });
                }
            });
        }

        function showCategoryDetail(name) {
            document.getElementById('detail-category-name').textContent = name;
            document.getElementById('detailCategoryModal').dataset.name = name;
            document.getElementById('detailCategoryModal').classList.add('active');
        }

        function closeDetailCategoryModal() {
            document.getElementById('detailCategoryModal').classList.remove('active');
        }

        function editCategoryFromDetail() {
            const modal = document.getElementById('detailCategoryModal');
            editCategory(modal.dataset.name);
            closeDetailCategoryModal();
        }

        function deleteCategoryFromDetail() {
            const modal = document.getElementById('detailCategoryModal');
            deleteCategory(modal.dataset.name);
            closeDetailCategoryModal();
        }
        
        async function addCategory() {
            const name = document.getElementById('add-category-name').value.trim();
            if (!name) {
                showMessage('add-category-message', 'Please enter a category name', true);
                return;
            }
            
            const { error } = await supabaseClient.from('product_categories').insert([{ name }]);
            if (error) {
                showMessage('add-category-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('categories-message', 'Category added successfully!');
            document.getElementById('add-category-name').value = '';
            closeAddCategoryModal();
            loadCategories();
        }

        function openAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('active');
        }

        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.remove('active');
            document.getElementById('add-category-message').innerHTML = '';
        }

        function editCategory(name) {
            document.getElementById('edit-category-old-name').value = name;
            document.getElementById('edit-category-name').value = name;
            document.getElementById('editCategoryModal').classList.add('active');
        }

        function closeEditCategoryModal() {
            document.getElementById('editCategoryModal').classList.remove('active');
        }

        async function updateCategory() {
            const oldName = document.getElementById('edit-category-old-name').value;
            const newName = document.getElementById('edit-category-name').value.trim();
            
            if (!newName) {
                showMessage('edit-category-message', 'Please enter a category name', true);
                return;
            }
            
            const { error } = await supabaseClient
                .from('product_categories')
                .update({ name: newName })
                .eq('name', oldName);
            
            if (error) {
                showMessage('edit-category-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('categories-message', 'Category updated successfully!');
            closeEditCategoryModal();
            loadCategories();
        }
        
        async function deleteCategory(name) {
            if (!confirm(`Delete category "${name}"?`)) return;
            
            const { error } = await supabaseClient.from('product_categories').delete().eq('name', name);
            if (error) {
                alert('Error: ' + error.message);
                return;
            }
            
            showMessage('categories-message', 'Category deleted successfully!');
            loadCategories();
        }
        
        // ===== PRODUCTS =====
        let allProducts = []; // Store all products for filtering

        async function loadProducts() {
            const container = document.getElementById('products-list');
            const { data, error } = await supabaseClient
                .from('products')
                .select('*, category:product_categories(name)')
                .order('name');
            
            if (error) {
                container.innerHTML = '<p class="error">Error loading products: ' + error.message + '</p>';
                return;
            }
            
            allProducts = data; // Store for filtering
            displayProducts(data);
            
            // Load categories and units for dropdowns
            const { data: categories } = await supabaseClient.from('product_categories').select('*').order('name');
            const { data: units } = await supabaseClient.from('units').select('*').order('name');
            
            // Populate add form category dropdown
            const select = document.getElementById('product-category');
            select.innerHTML = '<option value="">Select category</option>';
            if (categories) {
                categories.forEach(cat => {
                    select.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
                });
            }
            
            // Populate add form unit dropdown
            const unitSelect = document.getElementById('product-unit');
            unitSelect.innerHTML = '<option value="">Select unit</option>';
            if (units) {
                units.forEach(unit => {
                    unitSelect.innerHTML += `<option value="${unit.name}">${unit.name}</option>`;
                });
            }
            
            // Populate filter dropdown
            const filterSelect = document.getElementById('filter-product-category');
            filterSelect.innerHTML = '<option value="">All Categories</option>';
            if (categories) {
                categories.forEach(cat => {
                    filterSelect.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
                });
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('products-list');
            
            if (products.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">No products found matching your filters.</p>';
                return;
            }
            
            let html = '<table><tr><th>Name</th><th>Category</th><th>Unit</th><th>Description</th><th>Price</th></tr>';
            products.forEach((prod, index) => {
                const rowId = `product-row-${index}`;
                html += `<tr id="${rowId}" style="cursor: pointer;" 
                    data-name="${encodeURIComponent(prod.name)}" 
                    data-category="${encodeURIComponent(prod.category ? prod.category.name : '')}" 
                    data-unit="${encodeURIComponent(prod.unit || '')}" 
                    data-description="${encodeURIComponent(prod.description || '')}" 
                    data-price="${prod.base_price || 0}">
                    <td>${prod.name}</td>
                    <td>${prod.category ? prod.category.name : 'N/A'}</td>
                    <td>${prod.unit || 'N/A'}</td>
                    <td>${prod.description || ''}</td>
                    <td>‚Ç±${parseFloat(prod.base_price || 0).toFixed(2)}</td>
                </tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
            
            // Add click listeners after HTML is inserted
            products.forEach((prod, index) => {
                const row = document.getElementById(`product-row-${index}`);
                if (row) {
                    row.addEventListener('click', function() {
                        showProductDetail(
                            decodeURIComponent(this.dataset.name),
                            decodeURIComponent(this.dataset.category),
                            decodeURIComponent(this.dataset.unit),
                            decodeURIComponent(this.dataset.description),
                            this.dataset.price
                        );
                    });
                }
            });
        }

        function showProductDetail(name, category, unit, description, price) {
            document.getElementById('detail-product-name').textContent = name;
            document.getElementById('detail-product-category').textContent = category || 'N/A';
            document.getElementById('detail-product-unit').textContent = unit || 'N/A';
            document.getElementById('detail-product-description').textContent = description || 'No description';
            document.getElementById('detail-product-price').textContent = '‚Ç±' + parseFloat(price || 0).toFixed(2);
            
            // Store data for edit/delete
            document.getElementById('detailProductModal').dataset.name = name;
            document.getElementById('detailProductModal').dataset.category = category;
            document.getElementById('detailProductModal').dataset.unit = unit;
            document.getElementById('detailProductModal').dataset.description = description;
            document.getElementById('detailProductModal').dataset.price = price;
            
            document.getElementById('detailProductModal').classList.add('active');
        }

        function closeDetailProductModal() {
            document.getElementById('detailProductModal').classList.remove('active');
        }

        function editFromDetail() {
            const modal = document.getElementById('detailProductModal');
            editProduct(
                modal.dataset.name,
                modal.dataset.category,
                modal.dataset.unit,
                modal.dataset.description,
                modal.dataset.price
            );
            closeDetailProductModal();
        }

        function deleteFromDetail() {
            const modal = document.getElementById('detailProductModal');
            deleteProduct(modal.dataset.name);
            closeDetailProductModal();
        }

        function searchProducts() {
            const searchQuery = document.getElementById('search-product-name').value.toLowerCase();
            const categoryFilter = document.getElementById('filter-product-category').value.toLowerCase();
            
            const filtered = allProducts.filter(prod => {
                const matchesSearch = !searchQuery || prod.name.toLowerCase().includes(searchQuery) || (prod.description && prod.description.toLowerCase().includes(searchQuery));
                const matchesCategory = !categoryFilter || (prod.category && prod.category.name.toLowerCase() === categoryFilter);
                return matchesSearch && matchesCategory;
            });
            
            displayProducts(filtered);
        }

        function filterProducts() {
            const categoryFilter = document.getElementById('filter-product-category').value.toLowerCase();
            const nameFilter = document.getElementById('filter-product-name').value.toLowerCase();
            
            const filtered = allProducts.filter(prod => {
                const matchesCategory = !categoryFilter || (prod.category && prod.category.name.toLowerCase() === categoryFilter);
                const matchesName = !nameFilter || prod.name.toLowerCase().includes(nameFilter);
                return matchesCategory && matchesName;
            });
            
            displayProducts(filtered);
        }

        async function openProductFilterModal() {
            // Load categories for filter
            const { data: categories } = await supabaseClient.from('product_categories').select('*').order('name');
            const filterSelect = document.getElementById('filter-product-category');
            filterSelect.innerHTML = '<option value="">All Categories</option>';
            if (categories) {
                categories.forEach(cat => {
                    filterSelect.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
                });
            }
            
            document.getElementById('productFilterModal').classList.add('active');
        }

        function closeProductFilterModal() {
            document.getElementById('productFilterModal').classList.remove('active');
        }

        function applyProductFilter() {
            filterProducts();
            closeProductFilterModal();
        }

        function clearProductFilters() {
            document.getElementById('filter-product-category').value = '';
            document.getElementById('filter-product-name').value = '';
            document.getElementById('search-product-name').value = '';
            displayProducts(allProducts);
            closeProductFilterModal();
        }
        
        async function addProduct() {
            const name = document.getElementById('add-product-name').value.trim();
            const category = document.getElementById('add-product-category').value;
            const unit = document.getElementById('add-product-unit').value;
            const description = document.getElementById('add-product-description').value.trim();
            const price = parseFloat(document.getElementById('add-product-price').value) || 0;
            
            if (!name || !category || !unit) {
                showMessage('add-product-message', 'Please fill in all required fields (name, category, and unit)', true);
                return;
            }
            
            const { error } = await supabaseClient.from('products').insert([{
                name,
                category,
                unit,
                description,
                base_price: price
            }]);
            
            if (error) {
                showMessage('add-product-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('products-message', 'Product added successfully!');
            document.getElementById('add-product-name').value = '';
            document.getElementById('add-product-unit').value = '';
            document.getElementById('add-product-description').value = '';
            document.getElementById('add-product-price').value = '';
            closeAddProductModal();
            loadProducts();
        }

        async function openAddProductModal() {
            // Load categories and units
            const { data: categories } = await supabaseClient.from('product_categories').select('*').order('name');
            const { data: units } = await supabaseClient.from('units').select('*').order('name');
            
            const catSelect = document.getElementById('add-product-category');
            catSelect.innerHTML = '<option value="">Select category</option>';
            if (categories) {
                categories.forEach(cat => {
                    catSelect.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
                });
            }
            
            const unitSelect = document.getElementById('add-product-unit');
            unitSelect.innerHTML = '<option value="">Select unit</option>';
            if (units) {
                units.forEach(unit => {
                    unitSelect.innerHTML += `<option value="${unit.name}">${unit.name}</option>`;
                });
            }
            
            document.getElementById('addProductModal').classList.add('active');
        }

        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('active');
            document.getElementById('add-product-message').innerHTML = '';
        }

        async function editProduct(name, category, unit, description, price) {
            document.getElementById('edit-product-old-name').value = name;
            document.getElementById('edit-product-name').value = name;
            document.getElementById('edit-product-description').value = description;
            document.getElementById('edit-product-price').value = price;
            
            // Load categories and units for edit modal
            const { data: categories } = await supabaseClient.from('product_categories').select('*').order('name');
            const { data: units } = await supabaseClient.from('units').select('*').order('name');
            
            // Populate category dropdown
            const select = document.getElementById('edit-product-category');
            select.innerHTML = '<option value="">Select category</option>';
            if (categories) {
                categories.forEach(cat => {
                    const selected = cat.name === category ? 'selected' : '';
                    select.innerHTML += `<option value="${cat.name}" ${selected}>${cat.name}</option>`;
                });
            }
            
            // Populate unit dropdown
            const unitSelect = document.getElementById('edit-product-unit');
            unitSelect.innerHTML = '<option value="">Select unit</option>';
            if (units) {
                units.forEach(u => {
                    const selected = u.name === unit ? 'selected' : '';
                    unitSelect.innerHTML += `<option value="${u.name}" ${selected}>${u.name}</option>`;
                });
            }
            
            document.getElementById('editProductModal').classList.add('active');
        }

        function closeEditProductModal() {
            document.getElementById('editProductModal').classList.remove('active');
        }

        async function updateProduct() {
            const oldName = document.getElementById('edit-product-old-name').value;
            const newName = document.getElementById('edit-product-name').value.trim();
            const category = document.getElementById('edit-product-category').value;
            const unit = document.getElementById('edit-product-unit').value;
            const description = document.getElementById('edit-product-description').value.trim();
            const price = parseFloat(document.getElementById('edit-product-price').value) || 0;
            
            if (!newName || !category || !unit) {
                showMessage('edit-product-message', 'Please fill in all required fields (name, category, and unit)', true);
                return;
            }
            
            const { error } = await supabaseClient
                .from('products')
                .update({
                    name: newName,
                    category,
                    unit,
                    description,
                    base_price: price
                })
                .eq('name', oldName);
            
            if (error) {
                showMessage('edit-product-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('products-message', 'Product updated successfully!');
            closeEditProductModal();
            loadProducts();
        }
        
        async function deleteProduct(name) {
            if (!confirm(`Delete product "${name}"?`)) return;
            
            const { error } = await supabaseClient.from('products').delete().eq('name', name);
            if (error) {
                alert('Error: ' + error.message);
                return;
            }
            
            showMessage('products-message', 'Product deleted successfully!');
            loadProducts();
        }
        
        // ===== PACKAGE TYPES =====
        async function loadPackageTypes() {
            const container = document.getElementById('package-types-list');
            const { data, error } = await supabaseClient.from('package_type').select('*').order('name');
            
            if (error) {
                container.innerHTML = '<p class="error">Error loading package types: ' + error.message + '</p>';
                return;
            }
            
            let html = '<table><tr><th>Name</th><th>Description</th></tr>';
            data.forEach((pkg, index) => {
                const rowId = `package-row-${index}`;
                html += `<tr id="${rowId}" style="cursor: pointer;" 
                    data-name="${encodeURIComponent(pkg.name)}" 
                    data-description="${encodeURIComponent(pkg.description || '')}">
                    <td>${pkg.name}</td>
                    <td>${pkg.description || ''}</td>
                </tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
            
            // Add click listeners
            data.forEach((pkg, index) => {
                const row = document.getElementById(`package-row-${index}`);
                if (row) {
                    row.addEventListener('click', function() {
                        showPackageDetail(
                            decodeURIComponent(this.dataset.name),
                            decodeURIComponent(this.dataset.description)
                        );
                    });
                }
            });
        }

        function showPackageDetail(name, description) {
            document.getElementById('detail-package-name').textContent = name;
            document.getElementById('detail-package-description').textContent = description || 'No description';
            document.getElementById('detailPackageModal').dataset.name = name;
            document.getElementById('detailPackageModal').dataset.description = description;
            document.getElementById('detailPackageModal').classList.add('active');
        }

        function closeDetailPackageModal() {
            document.getElementById('detailPackageModal').classList.remove('active');
        }

        function editPackageFromDetail() {
            const modal = document.getElementById('detailPackageModal');
            editPackageType(modal.dataset.name, modal.dataset.description);
            closeDetailPackageModal();
        }

        function deletePackageFromDetail() {
            const modal = document.getElementById('detailPackageModal');
            deletePackageType(modal.dataset.name);
            closeDetailPackageModal();
        }
        
        async function addPackageType() {
            const name = document.getElementById('add-package-name').value.trim();
            const description = document.getElementById('add-package-description').value.trim();
            
            if (!name) {
                showMessage('add-package-type-message', 'Please enter a package name', true);
                return;
            }
            
            const { error } = await supabaseClient.from('package_type').insert([{ name, description }]);
            if (error) {
                showMessage('add-package-type-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('package-types-message', 'Package type added successfully!');
            document.getElementById('add-package-name').value = '';
            document.getElementById('add-package-description').value = '';
            closeAddPackageTypeModal();
            loadPackageTypes();
        }

        function openAddPackageTypeModal() {
            document.getElementById('addPackageTypeModal').classList.add('active');
        }

        function closeAddPackageTypeModal() {
            document.getElementById('addPackageTypeModal').classList.remove('active');
            document.getElementById('add-package-type-message').innerHTML = '';
        }

        function editPackageType(name, description) {
            document.getElementById('edit-package-old-name').value = name;
            document.getElementById('edit-package-name').value = name;
            document.getElementById('edit-package-description').value = description;
            document.getElementById('editPackageModal').classList.add('active');
        }

        function closeEditPackageModal() {
            document.getElementById('editPackageModal').classList.remove('active');
        }

        async function updatePackageType() {
            const oldName = document.getElementById('edit-package-old-name').value;
            const newName = document.getElementById('edit-package-name').value.trim();
            const description = document.getElementById('edit-package-description').value.trim();
            
            if (!newName) {
                showMessage('edit-package-message', 'Please enter a package name', true);
                return;
            }
            
            const { error } = await supabaseClient
                .from('package_type')
                .update({
                    name: newName,
                    description
                })
                .eq('name', oldName);
            
            if (error) {
                showMessage('edit-package-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('package-types-message', 'Package type updated successfully!');
            closeEditPackageModal();
            loadPackageTypes();
        }
        
        async function deletePackageType(name) {
            if (!confirm(`Delete package type "${name}"?`)) return;
            
            const { error } = await supabaseClient.from('package_type').delete().eq('name', name);
            if (error) {
                alert('Error: ' + error.message);
                return;
            }
            
            showMessage('package-types-message', 'Package type deleted successfully!');
            loadPackageTypes();
        }
        
        // ===== PACKAGE PRODUCTS =====
        let allPackageProducts = []; // Store all package products for filtering
        let currentSelectedPackage = null;

        async function loadPackageProducts() {
            const container = document.getElementById('package-products-list');
            const { data, error } = await supabaseClient
                .from('package_type_products')
                .select('*')
                .order('package_type_name');
            
            if (error) {
                container.innerHTML = '<p class="error">Error loading package products: ' + error.message + '</p>';
                return;
            }
            
            allPackageProducts = data; // Store for filtering
            displayPackageProducts(data);
        }

        function displayPackageProducts(packageProducts) {
            const container = document.getElementById('package-products-list');
            
            if (packageProducts.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">No package products found matching your filters.</p>';
                return;
            }
            
            let html = '<table><tr><th>Package Type</th><th>Product</th><th>Actions</th></tr>';
            packageProducts.forEach(pp => {
                html += `<tr>
                    <td>${pp.package_type_name}</td>
                    <td>${pp.product_name}</td>
                    <td class="actions">
                        <button class="btn btn-danger" onclick="deletePackageProduct(${pp.id})">Remove</button>
                    </td>
                </tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
        }

        function searchPackageProducts() {
            const searchQuery = document.getElementById('search-package-product').value.toLowerCase();
            const packageFilter = document.getElementById('filter-package-type').value.toLowerCase();
            const productFilter = document.getElementById('filter-product').value.toLowerCase();
            
            const filtered = allPackageProducts.filter(pp => {
                const matchesSearch = !searchQuery || 
                    pp.package_type_name.toLowerCase().includes(searchQuery) || 
                    pp.product_name.toLowerCase().includes(searchQuery);
                const matchesPackage = !packageFilter || pp.package_type_name.toLowerCase() === packageFilter;
                const matchesProduct = !productFilter || pp.product_name.toLowerCase() === productFilter;
                return matchesSearch && matchesPackage && matchesProduct;
            });
            
            displayPackageProducts(filtered);
        }

        function filterPackageProducts() {
            const packageFilter = document.getElementById('filter-package-type').value.toLowerCase();
            const productFilter = document.getElementById('filter-product').value.toLowerCase();
            
            const filtered = allPackageProducts.filter(pp => {
                const matchesPackage = !packageFilter || pp.package_type_name.toLowerCase() === packageFilter;
                const matchesProduct = !productFilter || pp.product_name.toLowerCase() === productFilter;
                return matchesPackage && matchesProduct;
            });
            
            displayPackageProducts(filtered);
        }

        async function openPackageProductFilterModal() {
            // Load package types and products for filter
            const { data: packages } = await supabaseClient.from('package_type').select('*').order('name');
            const { data: products } = await supabaseClient.from('products').select('*').order('name');
            
            const filterPkgSelect = document.getElementById('filter-package-type');
            filterPkgSelect.innerHTML = '<option value="">All Package Types</option>';
            if (packages) {
                packages.forEach(pkg => {
                    filterPkgSelect.innerHTML += `<option value="${pkg.name}">${pkg.name}</option>`;
                });
            }
            
            const filterProdSelect = document.getElementById('filter-product');
            filterProdSelect.innerHTML = '<option value="">All Products</option>';
            if (products) {
                products.forEach(prod => {
                    filterProdSelect.innerHTML += `<option value="${prod.name}">${prod.name}</option>`;
                });
            }
            
            document.getElementById('packageProductFilterModal').classList.add('active');
        }

        function closePackageProductFilterModal() {
            document.getElementById('packageProductFilterModal').classList.remove('active');
        }

        function applyPackageProductFilter() {
            filterPackageProducts();
            closePackageProductFilterModal();
        }

        function clearPackageProductFilters() {
            document.getElementById('filter-package-type').value = '';
            document.getElementById('filter-product').value = '';
            document.getElementById('search-package-product').value = '';
            displayPackageProducts(allPackageProducts);
            closePackageProductFilterModal();
        }

        // New Add Package Product Modal
        async function openAddPackageProductModal() {
            // Load package types
            const { data: packages } = await supabaseClient.from('package_type').select('*').order('name');
            const pkgSelect = document.getElementById('pp-package-type-select');
            pkgSelect.innerHTML = '<option value="">Select a package type</option>';
            if (packages) {
                packages.forEach(pkg => {
                    pkgSelect.innerHTML += `<option value="${pkg.name}">${pkg.name}</option>`;
                });
            }
            
            // Add change event listener to load products when package is selected
            pkgSelect.onchange = async function() {
                if (this.value) {
                    document.getElementById('selected-package-name-new').textContent = this.value;
                    
                    // Load all products with checkboxes
                    const { data: products, error } = await supabaseClient
                        .from('products')
                        .select('*')
                        .order('name');
                    
                    if (error) {
                        alert('Error loading products: ' + error.message);
                        return;
                    }
                    
                    const checkboxList = document.getElementById('products-checkbox-list-new');
                    checkboxList.innerHTML = '';
                    
                    products.forEach(prod => {
                        const item = document.createElement('div');
                        item.className = 'product-checkbox-item';
                        item.innerHTML = `
                            <input type="checkbox" id="prod-new-${prod.id}" value="${prod.name}">
                            <label for="prod-new-${prod.id}">${prod.name}</label>
                        `;
                        checkboxList.appendChild(item);
                    });
                } else {
                    document.getElementById('selected-package-name-new').textContent = 'None';
                    document.getElementById('products-checkbox-list-new').innerHTML = '<div class="loading">Please select a package type first...</div>';
                }
            };
            
            document.getElementById('addPackageProductModal').classList.add('active');
        }

        function closeAddPackageProductModal() {
            document.getElementById('addPackageProductModal').classList.remove('active');
            document.getElementById('add-package-product-message').innerHTML = '';
            document.getElementById('pp-package-type-select').value = '';
            document.getElementById('selected-package-name-new').textContent = 'None';
            document.getElementById('products-checkbox-list-new').innerHTML = '<div class="loading">Please select a package type first...</div>';
        }

        async function addMultipleProductsNew() {
            const packageSelect = document.getElementById('pp-package-type-select');
            const selectedPackage = packageSelect.value;
            
            if (!selectedPackage) {
                showMessage('add-package-product-message', 'Please select a package type!', true);
                return;
            }
            
            const checkboxes = document.querySelectorAll('#products-checkbox-list-new input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                showMessage('add-package-product-message', 'Please select at least one product!', true);
                return;
            }
            
            const productsToAdd = Array.from(checkboxes).map(cb => ({
                package_type_name: selectedPackage,
                product_name: cb.value
            }));
            
            const { error } = await supabaseClient
                .from('package_type_products')
                .insert(productsToAdd);
            
            if (error) {
                showMessage('add-package-product-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('package-products-message', `Successfully added ${checkboxes.length} product(s) to package!`);
            closeAddPackageProductModal();
            loadPackageProducts();
        }

        // Modal functions for adding multiple products
        async function openAddProductsModal() {
            const packageSelect = document.getElementById('pp-package-type-select');
            const selectedPackage = packageSelect.value;
            
            if (!selectedPackage) {
                alert('Please select a package type first!');
                return;
            }
            
            currentSelectedPackage = selectedPackage;
            document.getElementById('selected-package-name').textContent = selectedPackage;
            
            // Load all products with checkboxes
            const { data: products, error } = await supabaseClient
                .from('products')
                .select('*')
                .order('name');
            
            if (error) {
                alert('Error loading products: ' + error.message);
                return;
            }
            
            const checkboxList = document.getElementById('products-checkbox-list');
            checkboxList.innerHTML = '';
            
            products.forEach(prod => {
                const item = document.createElement('div');
                item.className = 'product-checkbox-item';
                item.innerHTML = `
                    <input type="checkbox" id="prod-${prod.id}" value="${prod.name}">
                    <label for="prod-${prod.id}">${prod.name}</label>
                `;
                checkboxList.appendChild(item);
            });
            
            document.getElementById('addProductsModal').classList.add('active');
        }

        function closeAddProductsModal() {
            document.getElementById('addProductsModal').classList.remove('active');
            document.getElementById('add-products-message').innerHTML = '';
        }

        async function addMultipleProducts() {
            const checkboxes = document.querySelectorAll('#products-checkbox-list input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                showMessage('add-products-message', 'Please select at least one product!', true);
                return;
            }
            
            const productsToAdd = Array.from(checkboxes).map(cb => ({
                package_type_name: currentSelectedPackage,
                product_name: cb.value
            }));
            
            const { error } = await supabaseClient
                .from('package_type_products')
                .insert(productsToAdd);
            
            if (error) {
                showMessage('add-products-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('package-products-message', `Successfully added ${checkboxes.length} product(s) to package!`);
            closeAddProductsModal();
            loadPackageProducts();
        }
        
        async function deletePackageProduct(id) {
            if (!confirm('Remove this product from the package?')) return;
            
            const { error } = await supabaseClient.from('package_type_products').delete().eq('id', id);
            if (error) {
                alert('Error: ' + error.message);
                return;
            }
            
            showMessage('package-products-message', 'Product removed from package!');
            loadPackageProducts();
        }

        // ===== EMPLOYEES =====
        async function loadEmployees() {
            const container = document.getElementById('employees-list');
            const { data, error } = await supabaseClient.from('employees').select('*').order('employee_code');
            
            if (error) {
                container.innerHTML = '<p class="error">Error loading employees: ' + error.message + '</p>';
                return;
            }
            
            let html = '<table><tr><th>Employee Code</th><th>Full Name</th><th>Status</th></tr>';
            data.forEach((emp, index) => {
                const rowId = `employee-row-${index}`;
                html += `<tr id="${rowId}" style="cursor: pointer;" 
                    data-id="${emp.id}" 
                    data-code="${encodeURIComponent(emp.employee_code)}" 
                    data-name="${encodeURIComponent(emp.full_name)}" 
                    data-active="${emp.is_active}">
                    <td>${emp.employee_code}</td>
                    <td>${emp.full_name}</td>
                    <td>${emp.is_active ? '<span style="color: green;">Active</span>' : '<span style="color: red;">Inactive</span>'}</td>
                </tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
            
            // Add click listeners
            data.forEach((emp, index) => {
                const row = document.getElementById(`employee-row-${index}`);
                if (row) {
                    row.addEventListener('click', function() {
                        showEmployeeDetail(
                            this.dataset.id,
                            decodeURIComponent(this.dataset.code),
                            decodeURIComponent(this.dataset.name),
                            this.dataset.active === 'true'
                        );
                    });
                }
            });
        }

        function showEmployeeDetail(id, code, name, isActive) {
            document.getElementById('detail-employee-code').textContent = code;
            document.getElementById('detail-employee-name').textContent = name;
            const statusHtml = isActive ? '<span style="color: green; font-weight: bold;">Active</span>' : '<span style="color: red; font-weight: bold;">Inactive</span>';
            document.getElementById('detail-employee-status').innerHTML = statusHtml;
            
            document.getElementById('detailEmployeeModal').dataset.id = id;
            document.getElementById('detailEmployeeModal').dataset.code = code;
            document.getElementById('detailEmployeeModal').dataset.name = name;
            document.getElementById('detailEmployeeModal').dataset.active = isActive;
            document.getElementById('detailEmployeeModal').classList.add('active');
        }

        function closeDetailEmployeeModal() {
            document.getElementById('detailEmployeeModal').classList.remove('active');
        }

        function editEmployeeFromDetail() {
            const modal = document.getElementById('detailEmployeeModal');
            editEmployee(
                modal.dataset.id,
                modal.dataset.code,
                modal.dataset.name,
                modal.dataset.active === 'true'
            );
            closeDetailEmployeeModal();
        }

        function deleteEmployeeFromDetail() {
            const modal = document.getElementById('detailEmployeeModal');
            deleteEmployee(modal.dataset.id, modal.dataset.name);
            closeDetailEmployeeModal();
        }
        
        async function addEmployee() {
            const code = document.getElementById('add-employee-code').value.trim();
            const name = document.getElementById('add-employee-name').value.trim();
            const password = document.getElementById('add-employee-password').value;
            const isActive = document.getElementById('add-employee-status').value === 'true';
            
            if (!code || !name || !password) {
                showMessage('add-employee-message', 'Please fill in all fields', true);
                return;
            }
            
            const { error } = await supabaseClient.from('employees').insert([{
                employee_code: code,
                full_name: name,
                password_hash: password,
                is_active: isActive
            }]);
            
            if (error) {
                showMessage('add-employee-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('employees-message', 'Employee added successfully!');
            document.getElementById('add-employee-code').value = '';
            document.getElementById('add-employee-name').value = '';
            document.getElementById('add-employee-password').value = '';
            closeAddEmployeeModal();
            loadEmployees();
        }

        function openAddEmployeeModal() {
            document.getElementById('addEmployeeModal').classList.add('active');
        }

        function closeAddEmployeeModal() {
            document.getElementById('addEmployeeModal').classList.remove('active');
            document.getElementById('add-employee-message').innerHTML = '';
        }

        function editEmployee(id, code, name, isActive) {
            document.getElementById('edit-employee-id').value = id;
            document.getElementById('edit-employee-code').value = code;
            document.getElementById('edit-employee-fullname').value = name;
            document.getElementById('edit-employee-password').value = '';
            document.getElementById('edit-employee-active').value = isActive.toString();
            document.getElementById('editEmployeeModal').classList.add('active');
        }

        function closeEditEmployeeModal() {
            document.getElementById('editEmployeeModal').classList.remove('active');
        }

        async function updateEmployee() {
            const id = document.getElementById('edit-employee-id').value;
            const code = document.getElementById('edit-employee-code').value.trim();
            const name = document.getElementById('edit-employee-fullname').value.trim();
            const password = document.getElementById('edit-employee-password').value;
            const isActive = document.getElementById('edit-employee-active').value === 'true';
            
            if (!code || !name) {
                showMessage('edit-employee-message', 'Please fill in all required fields', true);
                return;
            }
            
            const updateData = {
                employee_code: code,
                full_name: name,
                is_active: isActive
            };
            
            // Only update password if a new one is provided
            if (password) {
                updateData.password_hash = password;
            }
            
            const { error } = await supabaseClient
                .from('employees')
                .update(updateData)
                .eq('id', id);
            
            if (error) {
                showMessage('edit-employee-message', 'Error: ' + error.message, true);
                return;
            }
            
            showMessage('employees-message', 'Employee updated successfully!');
            closeEditEmployeeModal();
            loadEmployees();
        }

        async function toggleEmployeeStatus(id, newStatus) {
            const { error } = await supabaseClient
                .from('employees')
                .update({ is_active: newStatus })
                .eq('id', id);
            
            if (error) {
                alert('Error: ' + error.message);
                return;
            }
            
            showMessage('employees-message', 'Employee status updated successfully!');
            loadEmployees();
        }
        
        async function deleteEmployee(id, name) {
            if (!confirm(`Delete employee "${name}"?`)) return;
            
            const { error } = await supabaseClient.from('employees').delete().eq('id', id);
            if (error) {
                alert('Error: ' + error.message);
                return;
            }
            
            showMessage('employees-message', 'Employee deleted successfully!');
            loadEmployees();
        }
        
        // Load tab data
        function loadTabData(tabName) {
            switch(tabName) {
                case 'units': loadUnits(); break;
                case 'categories': loadCategories(); break;
                case 'products': loadProducts(); break;
                case 'pos':
                    loadPackageTypes();
                    loadPackageProducts();
                    break;
                case 'employees': loadEmployees(); break;
            }
        }

        // Sub-tab switching for POS
        function switchPOSSubTab(subTabName) {
            // Remove active class from all sub-tabs
            document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.sub-page').forEach(p => p.style.display = 'none');
            
            // Add active class to clicked sub-tab
            event.target.classList.add('active');
            
            // Show the corresponding sub-page
            document.getElementById(subTabName).style.display = 'block';
            document.getElementById(subTabName).classList.add('active');
        }
        
        // Initial load
        loadUnits();
    </script>
</body>
</html>